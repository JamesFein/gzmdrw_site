<h2
  class="text-left d-flex justify-content-between align-items-center"
  data-toggle="collapse"
  data-target="#geneTableWrapper"
  aria-expanded="true"
  style="cursor: pointer"
>
  <span>Basic information of gene(s)</span>
  <i class="fas fa-chevron-up" style="font-size: 0.8em"></i>
</h2>
<div id="geneTableWrapper">
  <div class="table-responsive">
    <table id="geneTable" class="table table-striped table-bordered">
      <thead>
        <tr>
          <th class="align-top">ZS11 Gene ID</th>
          <th class="align-top">Darmor Gene ID</th>
          <th class="align-top">Darmor-bzh Gene ID</th>
          <th class="align-top">Express617 Gene ID</th>
          <th class="align-top">GanganF73 Gene ID</th>
          <th class="align-top">No2127 Gene ID</th>
          <th class="align-top">NY7 Gene ID</th>
          <th class="align-top">quinta Gene ID</th>
          <th class="align-top">Shengli3 Gene ID</th>
          <th class="align-top">Tapidor3 Gene ID</th>
          <th class="align-top">Westar Gene ID</th>
          <th class="align-top">Zheyou73 Gene ID</th>
        </tr>
      </thead>
      <tbody>
        <!-- 添加一个加载指示器 -->
        <tr>
          <td colspan="12" class="text-center">Loading data...</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<script src="${Prefix}js/mock-data/gene_index_mock_data.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    initializeGeneTable();
  });

  function initializeGeneTable() {
    try {
      console.log("Initializing gene table...");

      // 使用mock数据
      const tableData = geneIndexMockData.tableData;
      console.log("Table data:", tableData);

      // 检查jQuery和DataTables是否已加载
      if (typeof $ === "undefined") {
        throw new Error("jQuery is not loaded");
      }
      if (typeof $.fn.DataTable === "undefined") {
        throw new Error("DataTables is not loaded");
      }

      // 销毁现有的DataTable实例（如果存在）
      if ($.fn.DataTable.isDataTable("#geneTable")) {
        $("#geneTable").DataTable().destroy();
      }

      // 初始化DataTable
      const table = $("#geneTable").DataTable({
        data: tableData,
        order: [], // 禁用初始排序
        ordering: false, // 禁用排序功能
        dom:
          '<"row"<"col-sm-12 col-md-6"B><"col-sm-12 col-md-6"f>>' +
          '<"row"<"col-sm-12"tr>>' +
          '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7 d-flex justify-content-end"p>>',
        buttons: [
          "colvis", // 添加列显示/隐藏按钮
          {
            extend: "excel",
            text: '<i class="fas fa-file-excel"></i> Export Excel',
            className: "btn btn-success",
            title: "Gene Information",
          },
        ],
        pageLength: 10,
        scrollY: "400px",
        scrollCollapse: true,
        responsive: {
          details: {
            type: "column",
            target: "tr",
            renderer: function (api, rowIdx, columns) {
              return $.fn.dataTable.Responsive.renderer.tableAll({
                tableClass: "table",
              })(api, rowIdx, columns);
            },
          },
        },
        language: {
          search: "Search:",
          lengthMenu: "Show _MENU_ entries",
          info: "Showing _START_ to _END_ of _TOTAL_ entries",
          infoEmpty: "Showing 0 to 0 of 0 entries",
          infoFiltered: "(filtered from _MAX_ total entries)",
        },
        initComplete: function () {
          $(".dt-buttons .btn").addClass("me-2 mb-2");
          console.log("DataTable initialization complete");
        },
      });

      // 更新标题点击事件，添加图标切换
      $("h2").on("click", function () {
        const icon = $(this).find("i");
        $("#geneTableWrapper").collapse("toggle");

        // 切换图标
        if ($("#geneTableWrapper").hasClass("show")) {
          icon.removeClass("fa-chevron-down").addClass("fa-chevron-up");
        } else {
          icon.removeClass("fa-chevron-up").addClass("fa-chevron-down");
        }

        table.columns.adjust(); // 重新调整列宽
      });

      // 初始状态设置
      $("#geneTableWrapper").on("shown.bs.collapse", function () {
        $("h2 i").removeClass("fa-chevron-down").addClass("fa-chevron-up");
      });

      $("#geneTableWrapper").on("hidden.bs.collapse", function () {
        $("h2 i").removeClass("fa-chevron-up").addClass("fa-chevron-down");
      });

      // 响应式处理
      $(window).on("resize", function () {
        table.columns.adjust().draw();
      });

      console.log("Table initialization successful");
    } catch (error) {
      console.error("Error initializing DataTable:", error);
      $("#geneTable").before(
        '<div class="alert alert-danger">Error loading table data. Please try refreshing the page.</div>'
      );
    }
  }
</script>
