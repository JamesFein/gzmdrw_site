<!-- Required CSS packages:
  - Bootstrap 5.3.0: https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css
  - Font Awesome 6.5.1: https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css
  - DataTables Bootstrap 5: https://cdn.datatables.net/2.0.0/css/dataTables.bootstrap5.min.css
-->

<!-- Required JS packages:
  - jQuery 3.7.1: https://code.jquery.com/jquery-3.7.1.min.js
  - DataTables Core: https://cdn.datatables.net/2.0.0/js/dataTables.min.js
  - DataTables Bootstrap 5: https://cdn.datatables.net/2.0.0/js/dataTables.bootstrap5.min.js
  - DataTables Buttons: https://cdn.datatables.net/buttons/3.0.0/js/dataTables.buttons.min.js
  - JSZip (for Excel export): https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js
  - DataTables Buttons HTML5: https://cdn.datatables.net/buttons/3.0.0/js/buttons.html5.min.js
-->

<div class="mx-auto bg-white rounded shadow-sm p-4 mt-4">
  <h2
    class="text-left d-flex justify-content-between align-items-center mb-4"
    style="cursor: pointer"
  >
    <span>Basic information of gene(s)</span>
    <i class="fas fa-chevron-up" style="font-size: 0.8em"></i>
  </h2>
  <div class="table-responsive">
    <table id="geneTable" class="table table-striped table-bordered">
      <thead>
        <tr>
          <th class="align-top">ZS11 Gene ID</th>
          <th class="align-top">Darmor Gene ID</th>
          <th class="align-top">Darmor-bzh Gene ID</th>
          <th class="align-top">Express617 Gene ID</th>
          <th class="align-top">GanganF73 Gene ID</th>
          <th class="align-top">No2127 Gene ID</th>
          <th class="align-top">NY7 Gene ID</th>
          <th class="align-top">quinta Gene ID</th>
          <th class="align-top">Shengli3 Gene ID</th>
          <th class="align-top">Tapidor3 Gene ID</th>
          <th class="align-top">Westar Gene ID</th>
          <th class="align-top">Zheyou73 Gene ID</th>
        </tr>
      </thead>
      <tbody>
        <!-- 添加一个加载指示器 -->
        <tr>
          <td colspan="12" class="text-center">Loading data...</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<script src="${Prefix}js/mock-data/gene_index_mock_data.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    initializeGeneTable();
  });

  function initializeGeneTable() {
    try {
      console.log("Initializing gene table...");

      // 使用mock数据
      const tableData = geneIndexMockData.tableData;
      console.log("Table data:", tableData);

      // 检查jQuery和DataTables是否已加载
      if (typeof $ === "undefined") {
        throw new Error("jQuery is not loaded");
      }
      if (typeof $.fn.DataTable === "undefined") {
        throw new Error("DataTables is not loaded");
      }

      // 销毁现有的DataTable实例（如果存在）
      if ($.fn.DataTable.isDataTable("#geneTable")) {
        $("#geneTable").DataTable().destroy();
      }

      // 初始化DataTable
      const table = $("#geneTable").DataTable({
        data: geneIndexMockData.tableData,
        order: [[0, "asc"]], // 默认按第一列升序排序
        ordering: true, // 启用排序功能
        columns: [
          { title: "ZS11", orderable: true },
          { title: "Darmor", orderable: true },
          { title: "DarmorBzh", orderable: true },
          { title: "Express617", orderable: true },
          { title: "GanganF73", orderable: true },
          { title: "No2127", orderable: true },
          { title: "NY7", orderable: true },
          { title: "Quinta", orderable: true },
          { title: "Shengli3", orderable: true },
          { title: "Tapidor3", orderable: true },
          { title: "Westar", orderable: true },
          { title: "Zheyou73", orderable: true },
        ],
        dom:
          '<"row"<"col-sm-12 col-md-6"B><"col-sm-12 col-md-6"f>>' +
          '<"row"<"col-sm-12"tr>>' +
          '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7 d-flex mt-2 justify-content-end"p>>',
        buttons: [
          {
            extend: "excel",
            text: '<i class="fas fa-file-excel"></i> Export Excel',
            className: "btn btn-success",
            title: "Gene Information",
          },
        ],
        pageLength: 10,
        scrollY: "400px",
        scrollCollapse: true,
        responsive: {
          details: {
            type: "column",
            target: "tr",
          },
        },
        language: {
          search: "Search:",
          lengthMenu: "Show _MENU_ entries",
          info: "Showing _START_ to _END_ of _TOTAL_ entries",
          infoEmpty: "Showing 0 to 0 of 0 entries",
          infoFiltered: "(filtered from _MAX_ total entries)",
        },
        initComplete: function () {
          $(".dt-buttons .btn").addClass("me-2 mb-2");
          console.log("DataTable initialization complete");
        },
      });

      // 简化的标题点击事件
      $("h2").on("click", function () {
        const icon = $(this).find("i");
        // 检查第一列的可见性来判断当前状态
        const isVisible = table.column(0).visible();

        // 根据当前状态切换显示/隐藏
        if (isVisible) {
          table.columns().visible(false);
          icon.removeClass("fa-chevron-up").addClass("fa-chevron-down");
        } else {
          table.columns().visible(true);
          icon.removeClass("fa-chevron-down").addClass("fa-chevron-up");
        }
      });

      // 响应式处理
      $(window).on("resize", function () {
        table.columns.adjust().draw();
      });

      console.log("Table initialization successful");
    } catch (error) {
      console.error("Error initializing DataTable:", error);
      $("#geneTable").before(
        '<div class="alert alert-danger">Error loading table data. Please try refreshing the page.</div>'
      );
    }
  }
</script>
